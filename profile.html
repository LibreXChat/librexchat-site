<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Мой профиль — LibreXChat</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { background-color: #0d0c1d; color: white; font-family: 'Segoe UI', sans-serif; }
    .glow-box { border: 2px solid #00f0ff; border-radius: 10px; box-shadow: 0 0 15px #00f0ff; padding: 20px; }
    .glow-green { border: 2px solid #00ff9d; box-shadow: 0 0 15px #00ff9d; border-radius: 10px; padding: 20px; }
    .button-purple { background-color: #762ef7; transition: background 0.3s; }
    .button-purple:hover { background-color: #5b23bd; }
    .button-red { background-color: #e53935; transition: background 0.3s; }
    .button-red:hover { background-color: #c62828; }
    .fade-in { animation: fadeIn 0.7s ease-in-out; }
    @keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }
    #lang-switch { position: fixed; bottom: 10px; left: 15px; background: #3f3f46; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    #logout { position: fixed; top: 10px; right: 15px; background: #ef4444; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    #infoBox { position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 12px; opacity: 0; transition: opacity 0.5s; font-size: 14px; z-index: 9999; }
  </style>
</head>
<body class="fade-in">

<div id="lang-switch" onclick="switchLanguage()">RU | EN</div>
<div id="logout" onclick="logout()">Выход</div>
<div id="infoBox"></div>

<main class="max-w-7xl mx-auto py-10 px-4">
  <h1 class="text-4xl font-bold text-center mb-10" id="profile-title">Мой профиль</h1>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-10">

    <div class="space-y-4">
      <button class="w-full py-3 rounded button-purple" id="btn-profile">Данные профиля</button>
      <button class="w-full py-3 rounded button-purple" id="btn-characters">Персонажи</button>
      <button class="w-full py-3 rounded button-purple" id="btn-upload">Мой центр загрузок</button>
      <button class="w-full py-3 rounded bg-purple-800 cursor-not-allowed" id="btn-faction">Фракция</button>
      <button class="w-full py-3 rounded button-red" onclick="deleteProfile()" id="btn-delete">Удаление профиля</button>
    </div>

    <div class="glow-box">
      <div class="space-y-3 text-lg">
        <div><strong id="label-email">Email:</strong> <span id="email">Загрузка...</span></div>
        <div><strong id="label-balance">Счёт:</strong> <span id="balance">Ожидание данных...</span></div>
        <div><strong id="label-characters">Количество персонажей:</strong> <span id="characters">Ожидание данных...</span></div>
        <div><strong id="label-registration">Дата регистрации:</strong> <span id="registration">Загрузка...</span></div>
        <div><strong id="label-playtime">Время в игре:</strong> <span id="playtime">Ожидание сервера...</span></div>
      </div>
    </div>

    <div class="glow-green">
      <div class="space-y-4">
        <button class="w-full py-3 rounded button-purple" onclick="changeEmail()" id="btn-change-email">Сменить Email</button>
        <button class="w-full py-3 rounded button-purple" onclick="changePassword()" id="btn-change-password">Сменить пароль</button>
        <button class="w-full py-3 rounded button-purple" onclick="resetPassword()" id="btn-reset">Восстановление</button>
      </div>
    </div>

  </div>

  <div class="text-center text-xs text-gray-400 mt-10">
    © 2025 LibreXChat. Проект создан для всех без исключения.
  </div>
</main>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script>
const firebaseConfig = { /* сюда вставь свой конфиг */ };
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function showInfo(message, error = false) {
  const infoBox = document.getElementById('infoBox');
  infoBox.textContent = message;
  infoBox.style.background = error ? 'rgba(255,0,0,0.8)' : 'rgba(0,128,0,0.8)';
  infoBox.style.opacity = 1;
  setTimeout(() => infoBox.style.opacity = 0, 4000);
}

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('email').textContent = user.email;
    document.getElementById('registration').textContent = new Date(user.metadata.creationTime).toLocaleDateString(currentLang === 'ru' ? 'ru-RU' : 'en-US');
  } else {
    location.href = 'login.html';
  }
});

function changeEmail() {
  const newEmail = prompt('Введите новый Email:');
  if (newEmail) {
    auth.currentUser.verifyBeforeUpdateEmail(newEmail)
      .then(() => showInfo('Письмо отправлено на новый email для подтверждения.'))
      .catch(e => showInfo('Ошибка: ' + e.message, true));
  }
}

function changePassword() {
  const email = auth.currentUser.email;
  auth.sendPasswordResetEmail(email)
    .then(() => showInfo('Письмо для смены пароля отправлено.'))
    .catch(e => showInfo('Ошибка: ' + e.message, true));
}

function resetPassword() { changePassword(); }

function deleteProfile() {
  const email = prompt('Подтвердите Email для удаления:');
  const password = prompt('Введите пароль:');
  if (email && password) {
    const cred = firebase.auth.EmailAuthProvider.credential(email, password);
    auth.currentUser.reauthenticateWithCredential(cred)
      .then(() => auth.currentUser.delete())
      .then(() => showInfo('Профиль удалён. Перенаправляем...') || (location.href = 'index.html'))
      .catch(e => showInfo('Ошибка: ' + e.message, true));
  }
}

function logout() {
  auth.signOut().then(() => location.href = 'login.html');
}

let currentLang = localStorage.getItem('lang') || 'ru';
function switchLanguage() {
  currentLang = currentLang === 'ru' ? 'en' : 'ru';
  localStorage.setItem('lang', currentLang);
  applyTranslations();
}

function applyTranslations() {
  const texts = {
    ru: { profile: 'Мой профиль', data: 'Данные профиля', chars: 'Персонажи', upload: 'Мой центр загрузок', faction: 'Фракция', delete: 'Удаление профиля', changeEmail: 'Сменить Email', changePassword: 'Сменить пароль', restore: 'Восстановление', balance: 'Счёт:', characters: 'Количество персонажей:', registration: 'Дата регистрации:', playtime: 'Время в игре:' },
    en: { profile: 'My Profile', data: 'Profile Data', chars: 'Characters', upload: 'Upload Center', faction: 'Faction', delete: 'Delete Profile', changeEmail: 'Change Email', changePassword: 'Change Password', restore: 'Recovery', balance: 'Balance:', characters: 'Characters:', registration: 'Registration Date:', playtime: 'Playtime:' }
  };
  const t = texts[currentLang];
  document.getElementById('profile-title').textContent = t.profile;
  document.getElementById('btn-profile').textContent = t.data;
  document.getElementById('btn-characters').textContent = t.chars;
  document.getElementById('btn-upload').textContent = t.upload;
  document.getElementById('btn-faction').textContent = t.faction;
  document.getElementById('btn-delete').textContent = t.delete;
  document.getElementById('btn-change-email').textContent = t.changeEmail;
  document.getElementById('btn-change-password').textContent = t.changePassword;
  document.getElementById('btn-reset').textContent = t.restore;
  document.getElementById('label-email').textContent = t.email;
  document.getElementById('label-balance').textContent = t.balance;
  document.getElementById('label-characters').textContent = t.characters;
  document.getElementById('label-registration').textContent = t.registration;
  document.getElementById('label-playtime').textContent = t.playtime;
  if (auth.currentUser) {
    document.getElementById('registration').textContent = new Date(auth.currentUser.metadata.creationTime).toLocaleDateString(currentLang === 'ru' ? 'ru-RU' : 'en-US');
  }
}

applyTranslations();
</script>

</body>
</html>
