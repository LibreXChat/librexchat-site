<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Мой профиль — LibreXChat</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { background-color: #0d0c1d; color: white; font-family: 'Segoe UI', sans-serif; transition: opacity 0.8s ease-in-out; opacity: 0; }
    body.fade-in { opacity: 1; }
    .glow-box { border: 2px solid #00f0ff; border-radius: 10px; box-shadow: 0 0 15px #00f0ff; padding: 20px; }
    .glow-green { border: 2px solid #00ff9d; box-shadow: 0 0 15px #00ff9d; border-radius: 10px; padding: 20px; }
    .button-purple { background-color: #762ef7; transition: background 0.3s; }
    .button-purple:hover { background-color: #5b23bd; }
    .button-red { background-color: #e53935; transition: background 0.3s; }
    .button-red:hover { background-color: #c62828; }
    #lang-switch { position: fixed; bottom: 10px; left: 15px; background: #3f3f46; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    #logout { position: fixed; top: 10px; right: 15px; background: #3f3f46; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    #infoBox { position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 12px; opacity: 0; transition: opacity 0.5s; font-size: 14px; z-index: 9999; }
  </style>
</head>
<body>

<div id="lang-switch" onclick="switchLanguage()">RU | EN</div>
<div id="logout" onclick="logout()">Выход</div>
<div id="infoBox"></div>

<main class="max-w-7xl mx-auto py-10 px-4">
  <h1 class="text-4xl font-bold text-center mb-10" id="profile-title">Мой профиль</h1>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
    <div class="space-y-4">
      <button class="w-full py-3 rounded button-purple" id="btn-profile">Данные профиля</button>
      <button class="w-full py-3 rounded button-purple" id="btn-characters">Персонажи</button>
      <button class="w-full py-3 rounded button-purple" id="btn-upload">Мой центр загрузок</button>
      <button class="w-full py-3 rounded bg-purple-800 cursor-not-allowed" id="btn-faction">Фракция</button>
      <button class="w-full py-3 rounded button-red" id="btn-delete">Удаление профиля</button>
    </div>
    <div class="glow-box">
      <div class="space-y-3 text-lg">
        <div><strong id="label-email">Email:</strong> <span id="email">Загрузка...</span></div>
        <div><strong id="label-balance">Счёт:</strong> <span id="balance">Ожидание данных...</span></div>
        <div><strong id="label-characters">Количество персонажей:</strong> <span id="characters">Ожидание данных...</span></div>
        <div><strong id="label-registration">Дата регистрации:</strong> <span id="registration">Загрузка...</span></div>
        <div><strong id="label-playtime">Время в игре:</strong> <span id="playtime">Ожидание сервера...</span></div>
      </div>
    </div>
    <div class="glow-green">
      <div class="space-y-4">
        <button class="w-full py-3 rounded button-purple" id="btn-change-email" onclick="changeEmail()">Сменить Email</button>
        <button class="w-full py-3 rounded button-purple" id="btn-change-password" onclick="changePassword()">Сменить пароль</button>
        <button class="w-full py-3 rounded button-purple" id="btn-reset-password" onclick="resetPassword()">Восстановление</button>
      </div>
    </div>
  </div>
  <div class="text-center text-xs text-gray-400 mt-10">
    © 2025 LibreXChat. Проект создан для всех без исключения.
  </div>
</main>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script>
const firebaseConfig = { /* твой конфиг */ };
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function showInfo(message, error = false) {
  const infoBox = document.getElementById('infoBox');
  infoBox.textContent = message;
  infoBox.style.background = error ? 'rgba(255, 0, 0, 0.8)' : 'rgba(0, 128, 0, 0.8)';
  infoBox.style.opacity = 1;
  setTimeout(() => { infoBox.style.opacity = 0; }, 4000);
}

function logout() {
  auth.signOut().then(() => {
    location.href = 'login.html';
  });
}

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('email').textContent = user.email;
    const date = new Date(user.metadata.creationTime);
    document.getElementById('registration').textContent = formatDate(date);
  } else {
    location.href = 'login.html';
  }
});

function formatDate(date) {
  const optionsRU = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' };
  const optionsEN = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false };
  return date.toLocaleString(currentLang === 'ru' ? 'ru-RU' : 'en-US', currentLang === 'ru' ? optionsRU : optionsEN);
}

function changeEmail() {
  const newEmail = prompt(currentLang === 'ru' ? 'Введите новый Email:' : 'Enter new Email:');
  if (newEmail) {
    auth.currentUser.verifyBeforeUpdateEmail(newEmail)
      .then(() => showInfo(currentLang === 'ru' ? 'Письмо отправлено на новый email.' : 'Email verification sent.'))
      .catch(error => showInfo('Ошибка: ' + error.message, true));
  }
}

function changePassword() {
  const email = auth.currentUser.email;
  auth.sendPasswordResetEmail(email)
    .then(() => showInfo(currentLang === 'ru' ? 'Письмо для смены пароля отправлено.' : 'Password reset email sent.'))
    .catch(error => showInfo('Ошибка: ' + error.message, true));
}

function resetPassword() { changePassword(); }

let currentLang = localStorage.getItem('lang') || 'ru';
function switchLanguage() {
  currentLang = currentLang === 'ru' ? 'en' : 'ru';
  localStorage.setItem('lang', currentLang);
  applyTranslations();
}

function applyTranslations() {
  const t = {
    ru: { profile: 'Мой профиль', data: 'Данные профиля', chars: 'Персонажи', upload: 'Мой центр загрузок', faction: 'Фракция', delete: 'Удаление профиля', changeEmail: 'Сменить Email', changePassword: 'Сменить пароль', restore: 'Восстановление', balance: 'Счёт:', characters: 'Количество персонажей:', registration: 'Дата регистрации:', playtime: 'Время в игре:' },
    en: { profile: 'My Profile', data: 'Profile Data', chars: 'Characters', upload: 'My Upload Center', faction: 'Faction', delete: 'Delete Profile', changeEmail: 'Change Email', changePassword: 'Change Password', restore: 'Recovery', balance: 'Balance:', characters: 'Characters:', registration: 'Registration Date:', playtime: 'Playtime:' }
  }[currentLang];

  document.getElementById('profile-title').textContent = t.profile;
  document.getElementById('btn-profile').textContent = t.data;
  document.getElementById('btn-characters').textContent = t.chars;
  document.getElementById('btn-upload').textContent = t.upload;
  document.getElementById('btn-faction').textContent = t.faction;
  document.getElementById('btn-delete').textContent = t.delete;
  document.getElementById('btn-change-email').textContent = t.changeEmail;
  document.getElementById('btn-change-password').textContent = t.changePassword;
  document.getElementById('btn-reset-password').textContent = t.restore;
  document.getElementById('label-balance').textContent = t.balance;
  document.getElementById('label-characters').textContent = t.characters;
  document.getElementById('label-registration').textContent = t.registration;
  document.getElementById('label-playtime').textContent = t.playtime;

  const date = new Date(auth.currentUser?.metadata.creationTime);
  if (!isNaN(date)) document.getElementById('registration').textContent = formatDate(date);
}

document.addEventListener('DOMContentLoaded', () => { document.body.classList.add('fade-in'); });
applyTranslations();
</script>

</body>
</html>
